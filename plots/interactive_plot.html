<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datos de los 32 Estados Mexicanos - Acceso a Salud</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .plot-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        #access-scatter-plot {
            width: 100%;
            height: 600px;
        }
        
        .instructions {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .btn {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            margin: 10px 5px;
            transition: background 0.3s ease;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-download {
            background: #27ae60;
        }
        
        .btn-download:hover {
            background: #219653;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 15px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 3px;
        }
        
        .high-restriction {
            background: #d73027;
        }
        
        .medium-restriction {
            background: #fdae61;
        }
        
        .low-restriction {
            background: #1a9850;
        }
        
        .size-legend {
            margin-top: 20px;
            text-align: center;
        }
        
        .size-examples {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin: 10px 0;
            height: 100px;
        }
        
        .size-example {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 15px;
        }
        
        .size-circle {
            border-radius: 50%;
            background: rgba(52, 152, 219, 0.5);
            border: 1px solid #2c3e50;
        }
        
        @media (max-width: 768px) {
            #access-scatter-plot {
                height: 500px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .legend {
                flex-direction: column;
                align-items: center;
            }
            
            .legend-item {
                margin: 5px 0;
            }
        }
        
        .local-warning {
            background-color: #ffecb3;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Datos de Acceso a Servicios de Salud</h1>
            <p class="subtitle">Visualización de los 32 estados mexicanos - Distancia vs Acceso Restringido</p>
        </header>
        
        <div class="content">
            <div class="local-warning" id="localWarning">
                <h3>⚠️ Visualización en modo local</h3>
                <p>Algunas funcionalidades pueden verse limitadas cuando se visualiza el archivo directamente desde el sistema local.</p>
                <p>Para la experiencia completa, despliegue este archivo en un servidor web como Netlify.</p>
            </div>
            
            <div class="instructions">
                <h3>Instrucciones de Uso</h3>
                <ul>
                    <li>Pase el cursor sobre cualquier punto para ver detalles del estado</li>
                    <li>El tamaño de los puntos representa la tasa de mortalidad por TB (AAMR_Hombres)</li>
                    <li>Los colores indican el nivel de acceso restringido: <span style="color:#d73027;">Alto</span>, <span style="color:#fdae61;">Medio</span>, <span style="color:#1a9850;">Bajo</span></li>
                    <li>Use los botones en la esquina superior derecha del gráfico para zoom, pan y otras acciones</li>
                    <li>Haga clic en el botón "Download Plot" para guardar una imagen del gráfico</li>
                </ul>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color high-restriction"></div>
                    <span>Alto acceso restringido (>30%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color medium-restriction"></div>
                    <span>Medio acceso restringido (15-30%)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color low-restriction"></div>
                    <span>Bajo acceso restringido (<15%)</span>
                </div>
            </div>
            
            <div class="size-legend">
                <h4>Tamaño de puntos según tasa de mortalidad TB (AAMR_Hombres)</h4>
                <div class="size-examples">
                    <div class="size-example">
                        <div class="size-circle" style="width: 15px; height: 15px;"></div>
                        <span>Baja</span>
                    </div>
                    <div class="size-example">
                        <div class="size-circle" style="width: 25px; height: 25px;"></div>
                        <span>Media</span>
                    </div>
                    <div class="size-example">
                        <div class="size-circle" style="width: 35px; height: 35px;"></div>
                        <span>Alta</span>
                    </div>
                </div>
            </div>
            
            <div class="plot-container">
                <div id="access-scatter-plot"></div>
            </div>
            
            <div style="text-align: center;">
                <a href="#" class="btn" onclick="openInNewTab()">Ver Gráfico Interactivo Completo</a>
                <a href="#" class="btn btn-download" onclick="downloadImage()">Descargar como Imagen</a>
            </div>
        </div>
        
        <footer>
            <p>© 2023 Visualización de Datos de Salud | Desplegado con Netlify</p>
        </footer>
    </div>

    <script>
        // Data from merged_hubdist_poprestricted.csv and aamr2023.csv
        const stateData = [
            { NOM_ENT: "Aguascalientes", mean: 23.44, acces_restric: 0.33, Mortality: 4.16, Distance: 23.44, AAMR_Hombres: 4.16 },
            { NOM_ENT: "Baja California", mean: 61.72, acces_restric: 6.45, Mortality: 7.87, Distance: 61.72, AAMR_Hombres: 11.99 },
            { NOM_ENT: "Baja California Sur", mean: 177.97, acces_restric: 65.66, Mortality: 6.51, Distance: 177.97, AAMR_Hombres: 7.85 },
            { NOM_ENT: "Campeche", mean: 124.77, acces_restric: 62.49, Mortality: 4.95, Distance: 124.77, AAMR_Hombres: 5.97 },
            { NOM_ENT: "Coahuila", mean: 43.37, acces_restric: 10.34, Mortality: 3.98, Distance: 43.37, AAMR_Hombres: 4.93 },
            { NOM_ENT: "Colima", mean: 32.90, acces_restric: 27.22, Mortality: 6.35, Distance: 32.90, AAMR_Hombres: 7.38 },
            { NOM_ENT: "Chiapas", mean: 47.87, acces_restric: 30.37, Mortality: 4.03, Distance: 47.87, AAMR_Hombres: 5.43 },
            { NOM_ENT: "Chihuahua", mean: 128.11, acces_restric: 28.43, Mortality: 3.19, Distance: 128.11, AAMR_Hombres: 4.58 },
            { NOM_ENT: "Ciudad de México", mean: 7.12, acces_restric: 0.0, Mortality: 1.20, Distance: 7.12, AAMR_Hombres: 1.71 },
            { NOM_ENT: "Durango", mean: 65.70, acces_restric: 23.82, Mortality: 3.21, Distance: 65.70, AAMR_Hombres: 4.14 },
            { NOM_ENT: "Guanajuato", mean: 42.26, acces_restric: 15.35, Mortality: 1.22, Distance: 42.26, AAMR_Hombres: 1.42 },
            { NOM_ENT: "Guerrero", mean: 79.95, acces_restric: 52.71, Mortality: 3.43, Distance: 79.95, AAMR_Hombres: 4.45 },
            { NOM_ENT: "Hidalgo", mean: 58.69, acces_restric: 32.02, Mortality: 2.15, Distance: 58.69, AAMR_Hombres: 3.17 },
            { NOM_ENT: "Jalisco", mean: 50.60, acces_restric: 20.24, Mortality: 2.20, Distance: 50.60, AAMR_Hombres: 3.11 },
            { NOM_ENT: "Estado de México", mean: 25.00, acces_restric: 1.61, Mortality: 0.98, Distance: 25.00, AAMR_Hombres: 1.06 },
            { NOM_ENT: "Michoacán", mean: 42.96, acces_restric: 25.60, Mortality: 1.55, Distance: 42.96, AAMR_Hombres: 1.90 },
            { NOM_ENT: "Morelos", mean: 16.14, acces_restric: 0.0, Mortality: 3.85, Distance: 16.14, AAMR_Hombres: 4.40 },
            { NOM_ENT: "Nayarit", mean: 55.39, acces_restric: 24.65, Mortality: 5.57, Distance: 55.39, AAMR_Hombres: 7.90 },
            { NOM_ENT: "Nuevo León", mean: 54.52, acces_restric: 6.08, Mortality: 6.49, Distance: 54.52, AAMR_Hombres: 9.74 },
            { NOM_ENT: "Oaxaca", mean: 87.15, acces_restric: 58.49, Mortality: 3.29, Distance: 87.15, AAMR_Hombres: 4.25 },
            { NOM_ENT: "Puebla", mean: 42.87, acces_restric: 20.59, Mortality: 1.42, Distance: 42.87, AAMR_Hombres: 1.89 },
            { NOM_ENT: "Querétaro", mean: 43.20, acces_restric: 9.0, Mortality: 4.43, Distance: 43.20, AAMR_Hombres: 7.16 },
            { NOM_ENT: "Quintana Roo", mean: 173.25, acces_restric: 47.64, Mortality: 5.43, Distance: 173.25, AAMR_Hombres: 7.83 },
            { NOM_ENT: "San Luis Potosí", mean: 62.02, acces_restric: 32.51, Mortality: 3.56, Distance: 62.02, AAMR_Hombres: 4.78 },
            { NOM_ENT: "Sinaloa", mean: 36.37, acces_restric: 10.14, Mortality: 5.95, Distance: 36.37, AAMR_Hombres: 9.72 },
            { NOM_ENT: "Sonora", mean: 80.75, acces_restric: 41.82, Mortality: 5.89, Distance: 80.75, AAMR_Hombres: 9.69 },
            { NOM_ENT: "Tabasco", mean: 49.34, acces_restric: 21.08, Mortality: 4.23, Distance: 49.34, AAMR_Hombres: 6.33 },
            { NOM_ENT: "Tamaulipas", mean: 59.57, acces_restric: 11.34, Mortality: 4.75, Distance: 59.57, AAMR_Hombres: 7.21 },
            { NOM_ENT: "Tlaxcala", mean: 19.18, acces_restric: 1.49, Mortality: 1.59, Distance: 19.18, AAMR_Hombres: 1.58 },
            { NOM_ENT: "Veracruz", mean: 60.22, acces_restric: 36.3, Mortality: 3.15, Distance: 60.22, AAMR_Hombres: 4.69 },
            { NOM_ENT: "Yucatán", mean: 69.21, acces_restric: 30.66, Mortality: 2.32, Distance: 69.21, AAMR_Hombres: 3.27 },
            { NOM_ENT: "Zacatecas", mean: 62.76, acces_restric: 38.83, Mortality: 3.46, Distance: 62.76, AAMR_Hombres: 4.41 }
        ];

        function createAccessScatterPlot(data) {
            // Calculate point sizes based on AAMR_Hombres values
            const minSize = 10;
            const maxSize = 40;
            const minMortality = Math.min(...data.map(d => d.AAMR_Hombres));
            const maxMortality = Math.max(...data.map(d => d.AAMR_Hombres));
            
            // Create trace for the scatter plot
            const trace = {
                x: data.map(d => d.mean),
                y: data.map(d => d.acces_restric),
                mode: 'markers+text',
                type: 'scatter',
                text: data.map(d => d.NOM_ENT),
                textposition: 'top',
                marker: {
                    size: data.map(d => minSize + (d.AAMR_Hombres - minMortality) / (maxMortality - minMortality) * (maxSize - minSize)),
                    color: data.map(d => {
                        // Color based on access restriction percentage
                        if (d.acces_restric > 30) return '#d73027'; // High restriction - red
                        if (d.acces_restric > 15) return '#fdae61'; // Medium restriction - orange
                        return '#1a9850'; // Low restriction - green
                    }),
                    opacity: 0.8,
                    line: {
                        color: 'rgba(0, 0, 0, 0.5)',
                        width: 1
                    }
                },
                hovertemplate: 
                    '<b>%{text}</b><br>' +
                    'Distancia media: %{x:.1f} km<br>' +
                    'Población con acceso restringido: %{y:.1f}%<br>' +
                    'Tasa mortalidad TB (AAMR_Hombres): %{customdata[1]:.2f}/100,000 hab.<extra></extra>',
                customdata: data.map(d => [d.Distance, d.AAMR_Hombres])
            };
            
            // Create layout
            const layout = {
                title: {
                    text: 'Relación entre distancia a hospitales y acceso restringido por Estado',
                    font: { size: 18 }
                },
                xaxis: {
                    title: 'Distancia media a hospitales con servicios de neumología (km)',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    zeroline: false
                },
                yaxis: {
                    title: 'Población con acceso restringido (%)',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    zeroline: false
                },
                height: 500,
                margin: { l: 80, r: 50, t: 80, b: 80 },
                annotations: [
                    {
                        x: 30,
                        y: 50,
                        xref: 'x',
                        yref: 'y',
                        text: 'Alto acceso restringido',
                        showarrow: false,
                        font: { color: '#d73027' },
                        bgcolor: 'white',
                        bordercolor: '#d73027',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 30,
                        y: 20,
                        xref: 'x',
                        yref: 'y',
                        text: 'Medio acceso restringido',
                        showarrow: false,
                        font: { color: '#fdae61' },
                        bgcolor: 'white',
                        bordercolor: '#fdae61',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 30,
                        y: 5,
                        xref: 'x',
                        yref: 'y',
                        text: 'Bajo acceso restringido',
                        showarrow: false,
                        font: { color: '#1a9850' },
                        bgcolor: 'white',
                        bordercolor: '#1a9850',
                        borderwidth: 1,
                        borderpad: 4
                    }
                ]
            };
            
            // Create the plot
            Plotly.newPlot('access-scatter-plot', [trace], layout, {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToAdd: [
                    {
                        name: 'Download Plot',
                        icon: Plotly.Icons.camera,
                        click: function(gd) {
                            Plotly.downloadImage(gd, {
                                format: 'png',
                                width: 1200,
                                height: 800,
                                filename: 'acceso_restringido_vs_distancia_2023'
                            });
                        }
                    }
                ]
            });
        }
        
        // Function to download image
        function downloadImage() {
            Plotly.downloadImage('access-scatter-plot', {
                format: 'png',
                width: 1200,
                height: 800,
                filename: 'acceso_restringido_vs_distancia_estados'
            });
        }
        
        // Function to open in new tab (for local testing)
        function openInNewTab() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }
        
        // Check if we're running locally
        function isLocal() {
            return window.location.protocol === 'file:';
        }

        // Initialize the plot when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Show warning if running locally
            if (isLocal()) {
                document.getElementById('localWarning').style.display = 'block';
            }
            
            createAccessScatterPlot(stateData);
        });
    </script>
</body>
</html>