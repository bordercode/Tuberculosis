<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distribución espacial de la mortalidad por tuberculosis en México 1998-2023</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .slide-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .slide {
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
            min-height: 500px;
        }
        
        .slide.active {
            display: block;
        }
        
        .slide-title {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .slide-content {
            font-size: 1.1rem;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .btn-nav {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-nav:hover {
            background-color: var(--secondary-color);
        }
        
        .progress-container {
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .figure-placeholder {
            background-color: #f1f1f1;
            border: 1px dashed #ccc;
            border-radius: 5px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }
        
        .reference {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }
        
        .highlight {
            background-color: rgba(231, 76, 60, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .key-fact {
            background-color: #e3f2fd;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 15px 0;
        }
        
        #interactive-plot {
            width: 100%;
            height: 600px;
            margin: 20px 0;
        }
        
        .plot-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            flex-direction: column;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .slide {
                padding: 15px;
            }
            
            .slide-title {
                font-size: 1.5rem;
            }
            
            #interactive-plot {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <header class="text-center mb-4">
            <h1 class="display-4" style="color: var(--secondary-color);">Distribución espacial de la mortalidad por tuberculosis en México 1998-2023</h1>
            <p class="lead">Evidencia hacia el cumplimiento de las metas de la estrategia Fin a la Tuberculosis 2030</p>
            <p class="text-muted">Dr. José Luis Manzanares Rivera</p>
        </header>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="slide-container">
            <!-- Slide 1: Introducción -->
            <div class="slide active" id="slide1">
                <h2 class="slide-title">Introducción</h2>
                <div class="slide-content">
                    <p>La tuberculosis (TB) sigue siendo un problema de salud pública significativo en México, a pesar de los avances globales en prevención y tratamiento.</p>
                    
                    <div class="key-fact">
                        <p><i class="fas fa-exclamation-circle"></i> <strong>En 2023:</strong> La TB cobró la vida de 2,740 personas en México, con tasas de mortalidad de hasta 12 por cada 100,000 habitantes en algunas regiones.</p>
                    </div>
                    
                    <p>México se encuentra entre los 10 países con mayor mortalidad por TB y menor cobertura de tratamiento en América Latina.</p>
                    
                    <p>La heterogeneidad de condiciones sociales, infraestructura hospitalaria y disponibilidad de personal especializado generan importantes desafíos para el control de esta enfermedad.</p>
                    
                    <p><strong>Objetivo principal:</strong> Analizar la distribución espacial y temporal de la mortalidad por TB en México entre 1998-2023 para identificar barreras en el acceso a servicios de diagnóstico y tratamiento.</p>
                </div>
                <div class="nav-buttons">
                    <button class="btn-nav" onclick="prevSlide()"><i class="fas fa-arrow-left"></i> Anterior</button>
                    <button class="btn-nav" onclick="nextSlide()">Siguiente <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <!-- Slide 2: Métodos -->
            <div class="slide" id="slide2">
                <h2 class="slide-title">Metodología</h2>
                <div class="slide-content">
                    <p><strong>Diseño del estudio:</strong> Análisis exploratorio retrospectivo de 25 años (1998-2023)</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Fuentes de datos:</h5>
                            <ul>
                                <li>Sistema Nacional de Información en Salud (SINAIS)</li>
                                <li>Registros de mortalidad oficiales</li>
                                <li>Datos del Consejo Nacional de Población (CONAPO)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Métodos analíticos:</h5>
                            <ul>
                                <li>Estimación de tasas de mortalidad estandarizadas</li>
                                <li>Análisis espacial con Sistemas de Información Geográfica</li>
                                <li>Análisis de varianza (ANOVA)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="key-fact">
                        <p><i class="fas fa-map-marked-alt"></i> <strong>Análisis espacial:</strong> Se estimaron distancias entre 3,995 localidades y 286 unidades hospitalarias con servicios de neumología.</p>
                    </div>
                    
                    <p><strong>Criterio de acceso restringido:</strong> Distancia superior a 50 km entre centro poblacional y unidad hospitalaria con servicios de neumología.</p>
                </div>
                <div class="nav-buttons">
                    <button class="btn-nav" onclick="prevSlide()"><i class="fas fa-arrow-left"></i> Anterior</button>
                    <button class="btn-nav" onclick="nextSlide()">Siguiente <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <!-- Slide 3: Tasas de Mortalidad 2023 -->
            <div class="slide" id="slide3">
                <h2 class="slide-title">Tasas de Mortalidad por TB (2023)</h2>
                <div class="slide-content">
                    <div class="plot-loading" id="plot-loading">
                        <div class="spinner"></div>
                        <p>Cargando visualización interactiva...</p>
                    </div>
                    <div id="interactive-plot"></div>
                    <p class="reference">Fuente: Elaboración propia con datos de SINAIS. Haga clic y arrastre para zoom, doble clic para resetear.</p>
                    
                    <div class="key-fact">
                        <p><i class="fas fa-chart-line"></i> <strong>Promedio nacional 2023:</strong> Hombres: <span id="avg-male">5.25</span>/100,000 hab. | Mujeres: <span id="avg-female">2.54</span>/100,000 hab.</p>
                    </div>
                    
                    <p><strong>Estados con mayor mortalidad:</strong></p>
                    <ul>
                        <li>Baja California (11.98 H, 3.75 M)</li>
                        <li>Nuevo León (9.74 H, 3.28 M)</li>
                        <li>Sonora (9.69 H, 2.08 M)</li>
                        <li>Sinaloa (9.72 H, 2.17 M)</li>
                        <li>Nayarit (7.89 H, 3.25 M)</li>
                    </ul>
                    
                    <p>La mayoría de los estados con alta mortalidad se ubican en la región noroeste del país.</p>
                </div>
                <div class="nav-buttons">
                    <button class="btn-nav" onclick="prevSlide()"><i class="fas fa-arrow-left"></i> Anterior</button>
                    <button class="btn-nav" onclick="nextSlide()">Siguiente <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <!-- Continue with the rest of your slides (4-10) -->
            <!-- ... -->
            
        </div>
        
        <footer class="text-center mt-4 pt-3 border-top">
            <p>© 2023 - Investigación sobre Distribución Espacial de la Mortalidad por Tuberculosis en México</p>
        </footer>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 10;
        
        function updateProgressBar() {
            const progress = (currentSlide / totalSlides) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }
        
        function showSlide(n) {
            document.querySelectorAll('.slide').forEach(slide => {
                slide.classList.remove('active');
            });
            
            document.getElementById(`slide${n}`).classList.add('active');
            currentSlide = n;
            updateProgressBar();
            
            // Load the interactive plot when reaching slide 3
            if (n === 3 && !window.plotLoaded) {
                loadInteractivePlot();
            }
        }
        
        function nextSlide() {
            if (currentSlide < totalSlides) {
                showSlide(currentSlide + 1);
            }
        }
        
        function prevSlide() {
            if (currentSlide > 1) {
                showSlide(currentSlide - 1);
            }
        }
        
        function goToFirstSlide() {
            showSlide(1);
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowRight') {
                nextSlide();
            } else if (event.key === 'ArrowLeft') {
                prevSlide();
            }
        });
        
        // Initialize progress bar
        updateProgressBar();
        
        // Sample data structure - replace this with your actual data
        const sampleData = [
            {State_Name: "Aguascalientes", AAMR_Hombres: 2.5, AAMR_Mujeres: 1.2, AAMR_Total: 1.85},
            {State_Name: "BC", AAMR_Hombres: 11.98, AAMR_Mujeres: 3.75, AAMR_Total: 7.87},
            {State_Name: "BCS", AAMR_Hombres: 3.2, AAMR_Mujeres: 1.8, AAMR_Total: 2.5},
            {State_Name: "Campeche", AAMR_Hombres: 4.1, AAMR_Mujeres: 2.3, AAMR_Total: 3.2},
            {State_Name: "Coahuila", AAMR_Hombres: 5.3, AAMR_Mujeres: 2.1, AAMR_Total: 3.7},
            {State_Name: "Colima", AAMR_Hombres: 3.8, AAMR_Mujeres: 1.9, AAMR_Total: 2.85},
            {State_Name: "Chiapas", AAMR_Hombres: 2.9, AAMR_Mujeres: 1.5, AAMR_Total: 2.2},
            {State_Name: "Chihuahua", AAMR_Hombres: 6.7, AAMR_Mujeres: 2.8, AAMR_Total: 4.75},
            {State_Name: "CDMX", AAMR_Hombres: 4.5, AAMR_Mujeres: 2.2, AAMR_Total: 3.35},
            {State_Name: "Durango", AAMR_Hombres: 5.1, AAMR_Mujeres: 2.4, AAMR_Total: 3.75},
            {State_Name: "Guanajuato", AAMR_Hombres: 3.6, AAMR_Mujeres: 1.7, AAMR_Total: 2.65},
            {State_Name: "Guerrero", AAMR_Hombres: 4.8, AAMR_Mujeres: 2.0, AAMR_Total: 3.4},
            {State_Name: "Hidalgo", AAMR_Hombres: 3.3, AAMR_Mujeres: 1.6, AAMR_Total: 2.45},
            {State_Name: "Jalisco", AAMR_Hombres: 4.2, AAMR_Mujeres: 1.9, AAMR_Total: 3.05},
            {State_Name: "EdoMx", AAMR_Hombres: 4.7, AAMR_Mujeres: 2.1, AAMR_Total: 3.4},
            {State_Name: "Michoacán", AAMR_Hombres: 4.0, AAMR_Mujeres: 1.8, AAMR_Total: 2.9},
            {State_Name: "Morelos", AAMR_Hombres: 3.9, AAMR_Mujeres: 1.9, AAMR_Total: 2.9},
            {State_Name: "Nayarit", AAMR_Hombres: 7.89, AAMR_Mujeres: 3.25, AAMR_Total: 5.57},
            {State_Name: "Nuevo León", AAMR_Hombres: 9.74, AAMR_Mujeres: 3.28, AAMR_Total: 6.51},
            {State_Name: "Oaxaca", AAMR_Hombres: 3.1, AAMR_Mujeres: 1.4, AAMR_Total: 2.25},
            {State_Name: "Puebla", AAMR_Hombres: 3.5, AAMR_Mujeres: 1.6, AAMR_Total: 2.55},
            {State_Name: "Querétaro", AAMR_Hombres: 3.0, AAMR_Mujeres: 1.3, AAMR_Total: 2.15},
            {State_Name: "Quintana Roo", AAMR_Hombres: 4.4, AAMR_Mujeres: 2.0, AAMR_Total: 3.2},
            {State_Name: "SLP", AAMR_Hombres: 4.6, AAMR_Mujeres: 2.1, AAMR_Total: 3.35},
            {State_Name: "Sinaloa", AAMR_Hombres: 9.72, AAMR_Mujeres: 2.17, AAMR_Total: 5.95},
            {State_Name: "Sonora", AAMR_Hombres: 9.69, AAMR_Mujeres: 2.08, AAMR_Total: 5.89},
            {State_Name: "Tabasco", AAMR_Hombres: 3.7, AAMR_Mujeres: 1.8, AAMR_Total: 2.75},
            {State_Name: "Tamaulipas", AAMR_Hombres: 5.5, AAMR_Mujeres: 2.3, AAMR_Total: 3.9},
            {State_Name: "Tlaxcala", AAMR_Hombres: 2.8, AAMR_Mujeres: 1.3, AAMR_Total: 2.05},
            {State_Name: "Veracruz", AAMR_Hombres: 4.3, AAMR_Mujeres: 1.9, AAMR_Total: 3.1},
            {State_Name: "Yucatán", AAMR_Hombres: 3.4, AAMR_Mujeres: 1.6, AAMR_Total: 2.5},
            {State_Name: "Zacatecas", AAMR_Hombres: 4.9, AAMR_Mujeres: 2.2, AAMR_Total: 3.55}
        ];
        
        // Function to load and create the interactive plot
        function loadInteractivePlot() {
            try {
                window.plotLoaded = true;
                document.getElementById('plot-loading').style.display = 'none';
                createInteractivePlot(sampleData);
            } catch (error) {
                console.error('Error creating plot:', error);
                document.getElementById('plot-loading').innerHTML = 
                    '<p>Error creando la visualización. Por favor, intente recargar la página.</p>';
            }
        }
        
        function createInteractivePlot(data) {
            // Process the data
            const df = data.map((row, index) => {
                return {
                    ...row,
                    Gender_Gap: row.AAMR_Hombres - row.AAMR_Mujeres
                };
            });
            
            // Sort by AAMR_Hombres in descending order
            df.sort((a, b) => b.AAMR_Hombres - a.AAMR_Hombres);
            
            // Calculate national averages
            const nat_avg_m = df.reduce((sum, row) => sum + row.AAMR_Hombres, 0) / df.length;
            const nat_avg_f = df.reduce((sum, row) => sum + row.AAMR_Mujeres, 0) / df.length;
            const nat_avg_gap = df.reduce((sum, row) => sum + row.Gender_Gap, 0) / df.length;
            
            // Update the averages in the text
            document.getElementById('avg-male').textContent = nat_avg_m.toFixed(2);
            document.getElementById('avg-female').textContent = nat_avg_f.toFixed(2);
            
            // Calculate gender differences for coloring
            const gender_difference = df.map(row => row.AAMR_Hombres - row.AAMR_Mujeres);
            const max_diff = Math.max(...gender_difference.map(Math.abs)) || 1;
            
            // Create traces for the plot
            const traces = [];
            
            // Add lines connecting men and women values
            df.forEach(row => {
                traces.push({
                    x: [row.AAMR_Hombres, row.AAMR_Mujeres],
                    y: [row.State_Name, row.State_Name],
                    mode: 'lines',
                    line: { color: 'gray', width: 1, opacity: 0.3 },
                    showlegend: false,
                    hoverinfo: 'none'
                });
            });
            
            // Add markers for men
            traces.push({
                x: df.map(row => row.AAMR_Hombres),
                y: df.map(row => row.State_Name),
                mode: 'markers',
                name: 'Hombres',
                marker: {
                    color: '#1f77b4',
                    size: 10,
                    line: { color: 'black', width: 1 }
                },
                hovertemplate: 
                    '<b>%{customdata[0]}</b><br>' +
                    'Tasa Hombres: %{x:.2f}<br>' +
                    'Tasa Mujeres: %{customdata[1]:.2f}<br>' +
                    'Brecha de Género: %{customdata[2]:.2f}<br>' +
                    'Tasa Total: %{customdata[3]:.2f}<extra></extra>',
                customdata: df.map(row => [
                    row.State_Name, 
                    row.AAMR_Mujeres, 
                    row.Gender_Gap, 
                    row.AAMR_Total
                ])
            });
            
            // Add markers for women
            traces.push({
                x: df.map(row => row.AAMR_Mujeres),
                y: df.map(row => row.State_Name),
                mode: 'markers',
                name: 'Mujeres',
                marker: {
                    color: '#ff7f0e',
                    size: 10,
                    symbol: 'square',
                    line: { color: 'black', width: 1 }
                },
                hovertemplate: 
                    '<b>%{customdata[0]}</b><br>' +
                    'Tasa Mujeres: %{x:.2f}<br>' +
                    'Tasa Hombres: %{customdata[1]:.2f}<br>' +
                    'Brecha de Género: %{customdata[2]:.2f}<br>' +
                    'Tasa Total: %{customdata[3]:.2f}<extra></extra>',
                customdata: df.map(row => [
                    row.State_Name, 
                    row.AAMR_Hombres, 
                    row.Gender_Gap, 
                    row.AAMR_Total
                ])
            });
            
            // Create layout
            const layout = {
                title: {
                    text: 'Tasas de Mortalidad por TB por Estado y Género (2023)',
                    font: { size: 16 }
                },
                xaxis: {
                    title: 'Tasa de Mortalidad Ajustada por Edad por TB (100,000 habitantes)',
                    showgrid: true,
                    gridcolor: 'rgba(0,0,0,0.1)',
                    zeroline: false
                },
                yaxis: {
                    title: 'Estado',
                    automargin: true,
                    tickmode: 'array',
                    tickvals: df.map((_, i) => i),
                    ticktext: df.map(row => row.State_Name)
                },
                height: 600,
                showlegend: true,
                legend: {
                    orientation: 'h',
                    yanchor: 'bottom',
                    y: 1.02,
                    xanchor: 'right',
                    x: 1
                },
                hovermode: 'closest',
                margin: { l: 150, r: 50, t: 80, b: 80 },
                shapes: [
                    // Average men line
                    {
                        type: 'line',
                        x0: nat_avg_m,
                        y0: -0.5,
                        x1: nat_avg_m,
                        y1: df.length - 0.5,
                        line: {
                            color: '#1f77b4',
                            width: 1.5,
                            dash: 'solid'
                        }
                    },
                    // Average women line
                    {
                        type: 'line',
                        x0: nat_avg_f,
                        y0: -0.5,
                        x1: nat_avg_f,
                        y1: df.length - 0.5,
                        line: {
                            color: '#ff7f0e',
                            width: 1.5,
                            dash: 'solid'
                        }
                    },
                    // OMS reference line
                    {
                        type: 'line',
                        x0: 1.8,
                        y0: -0.5,
                        x1: 1.8,
                        y1: df.length - 0.5,
                        line: {
                            color: 'black',
                            width: 1.5,
                            dash: 'dot'
                        }
                    },
                    // CONAPO reference line
                    {
                        type: 'line',
                        x0: 2.16,
                        y0: -0.5,
                        x1: 2.16,
                        y1: df.length - 0.5,
                        line: {
                            color: 'gray',
                            width: 1.5,
                            dash: 'dash'
                        }
                    }
                ],
                annotations: [
                    {
                        x: nat_avg_m,
                        y: df.length - 1,
                        text: `Promedio Hombres: ${nat_avg_m.toFixed(2)}`,
                        showarrow: false,
                        xanchor: 'left',
                        font: { color: '#1f77b4' },
                        bgcolor: 'white',
                        bordercolor: '#1f77b4',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: nat_avg_f,
                        y: df.length - 2,
                        text: `Promedio Mujeres: ${nat_avg_f.toFixed(2)}`,
                        showarrow: false,
                        xanchor: 'left',
                        font: { color: '#ff7f0e' },
                        bgcolor: 'white',
                        bordercolor: '#ff7f0e',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 1.8,
                        y: 0,
                        text: 'OMS: 1.8',
                        showarrow: false,
                        xanchor: 'left',
                        font: { size: 10 },
                        bgcolor: 'white',
                        bordercolor: 'black',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 2.16,
                        y: 1,
                        text: 'México (CONAPO): 2.16',
                        showarrow: false,
                        xanchor: 'right',
                        font: { size: 10, color: 'gray' },
                        bgcolor: 'white',
                        bordercolor: 'gray',
                        borderwidth: 1,
                        borderpad: 4
                    }
                ]
            };
            
            // Create the plot
            Plotly.newPlot('interactive-plot', traces, layout, {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToAdd: [
                    {
                        name: 'Download Plot',
                        icon: Plotly.Icons.camera,
                        click: function(gd) {
                            Plotly.downloadImage(gd, {
                                format: 'png',
                                width: 1200,
                                height: 800,
                                filename: 'TB_tasas_sex2023'
                            });
                        }
                    }
                ],
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
